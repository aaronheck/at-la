<!DOCTYPE html>
<html>
  <head>
    <title>Appalachian Trail, Los Angeles</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map {
        height: 100%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script>
      var map;
      function daysBetween( date1, date2 ) {
        //Get 1 day in milliseconds
        var one_day=1000*60*60*24;

        // Convert both dates to milliseconds
        var date1_ms = date1.getTime();
        var date2_ms = date2.getTime();

        // Calculate the difference in milliseconds
        var difference_ms = date2_ms - date1_ms;
          
        // Convert back to days and return
        return Math.round(difference_ms/one_day); 
      }
      function initMap() {

        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 6
        });
        map.fitBounds(new google.maps.LatLngBounds({lat: 34.626688, lng: -84.193892}, {lat: 45.90424, lng: -68.921152}))
        map.data.loadGeoJson(
          'http://aaronrosenheck.com/data/centerline.json');

        map.data.setStyle(function(feature) {
          var color = feature.getProperty('color');
          return {
            strokeColor: color,
            strokeWeight: 3,
            // icon: "marker.png"
          };
        });

        var infowindow = new google.maps.InfoWindow({
            content: "250 miles down"
          });
        map.data.addListener('click', function(event) {
          if(event.feature.getProperty("distanceFromStart")) {
            var distanceFromStart = (event.feature.getProperty("distanceFromStart") * 0.000621371).toFixed(2);
            var toGo = (2190 - distanceFromStart).toFixed(2);
            // Sunday, June 9, 2019 6:30:00 AM Pacific Time
            var daysSinceStart = daysBetween(new Date(1560087000000), new Date());
            var avgMilesPerDay = (distanceFromStart / daysSinceStart);
            var daysLeft = Math.ceil(toGo / avgMilesPerDay);
            var completionDate = new Date();
            completionDate.setDate(completionDate.getDate() + daysLeft);
            completionDate = completionDate.toString().split(" ").slice(0,4).join(" ")
            infowindow.setContent("<div style='width:150px; text-align:center;'> <h3>ATLA</h3>"+ distanceFromStart +" miles down " + toGo + " to go! <br><br> Avg Miles/ Day: " + avgMilesPerDay.toFixed(2) + " <br><br> Estimated completion date: " + completionDate + "</div>");
            // position the infowindow on the marker
            infowindow.setPosition(event.feature.getGeometry().get());
            // anchor the infowindow on the marker
            infowindow.setOptions({pixelOffset: new google.maps.Size(0,-30)});
            infowindow.open(map);
          }
        });
      }

    </script>

    <!-- Replace the access key below. removing it from source code because google sends me emails thinking it leaked even though it needs to be exposerd to the public in my website anyway. -->
    <script src="https://maps.googleapis.com/maps/api/js?key=<>&callback=initMap&libraries=geometry"
    async defer></script>
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
      ga('create', 'UA-53774413-1', 'auto');
      ga('send', 'pageview');
    </script>
  </body>
</html>